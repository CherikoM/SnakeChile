function e(e,t){return Math.floor(Math.random()*(t-e)+e)}var t,s;!function(e){e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN",e[e.LEFT=4]="LEFT"}(t||(t={}));class i{constructor(e,t){this.width=e,this.height=t,this.snakeIndex=[],this.perviousLastIndex=[0,0],this.dir=1,this.go=[[0,0],[0,-1],[1,0],[0,1],[-1,0]],this.width=e,this.height=t}newSnake(){const t=(e=this.dir,[t,s]=this.snakeIndex[0],[i,n]=this.snakeIndex[1])=>{const[h,a]=this.getNextIndex([i,n],e);return!(this.isOut([h,a])||h===t&&a===s)},s=()=>e(1,5);this.snakeIndex=[];const[i,n]=[e(0,this.width),e(0,this.height)];let h,a,o,r;for(;;){let e=s();const t=this.getNextIndex([i,n],e);if(!this.isOut(t)){h=t[0],a=t[1];break}}for(;;){let e=s();if(t(e,[i,n],[h,a])){const t=this.getNextIndex([h,a],e);o=t[0],r=t[1];break}}this.dir=this.getBodyDirection([i,n],[h,a]),this.snakeIndex.push([i,n],[h,a],[o,r])}changeDirection(e){this.isAvalibleDiretion(e)&&(this.dir=e)}isAvalibleDiretion(e=this.dir,[t,s]=this.snakeIndex[0],[i,n]=this.snakeIndex[1]){const[h,a]=this.getNextIndex([t,s],e);return!(this.isOut([h,a])||h===i&&a===n)}isOut([e,t]){return e<0||e>=this.width||t<0||t>=this.height}isCrash([e,t]){for(let s=0;s<this.snakeIndex.length-1;s++)if(e===this.snakeIndex[s][0]&&t===this.snakeIndex[s][1])return!0;return!1}getNextIndex([e,t],s=this.dir){return[e+this.go[s][0],t+this.go[s][1]]}getLastIndex([e,t],s=this.dir){return[e-this.go[s][0],t-this.go[s][1]]}move(){this.perviousLastIndex=this.snakeIndex[this.snakeIndex.length-1];const e=this.getNextIndex(this.snakeIndex[0]);return!this.isOut(e)&&(!this.isCrash(e)&&(this.snakeIndex.unshift(e),this.snakeIndex.pop(),!0))}eat(){this.snakeIndex.push(this.perviousLastIndex)}getSnake(){return this.snakeIndex}getSnakeLength(){return this.snakeIndex.length}getBodyDirection([e,s],[i,n]){const h=e-i,a=s-n;return 0===h&&-1===a?t.UP:1===h&&0===a?t.RIGHT:0===h&&1===a?t.DOWN:-1===h&&0===a?t.LEFT:0}}class n{constructor(e,t){this.width=e,this.height=t,this.index=[0,0],this.width=e,this.height=t}newFood(t){let s;e:for(;s=[e(0,this.width),e(0,this.height)],t;)for(let e=0;e<t.length&&(t[e][0]!==s[0]||t[e][1]!==s[1]);e++)if(e===t.length-1)break e;this.index=s}getFoodIndex(){return this.index}}class h{constructor(e,t){this.width=e,this.height=t,this.score=0,this.gaming=!1,this.pausing=!1,this.snake=new i(e,t),this.food=new n(e,t)}start(){this.gaming=!0,this.pausing=!1,this.snake.newSnake(),this.food.newFood(this.getSnake())}over(){this.gaming=!1,this.pausing=!1}move(){return this.snake.move()?!this.eat()||"eat":(this.over(),!1)}eat(){return!!(()=>{const e=this.snake.getSnake()[0];return e[0]===this.food.getFoodIndex()[0]&&e[1]===this.food.getFoodIndex()[1]})()&&(this.snake.eat(),this.score++,this.food.newFood(this.snake.getSnake()),!0)}changeDirection(e){this.snake.changeDirection(e)}isGaming(){return this.gaming}getSnakeLength(){return this.snake.getSnakeLength()}getSnake(){return this.snake.getSnake()}getFood(){return this.food.getFoodIndex()}getScore(){return this.score}getSnakeBodyDirection([e,t],[s,i]){return this.snake.getBodyDirection([e,t],[s,i])}isPausing(){return this.pausing}pause(){this.pausing=!0}resume(){this.pausing=!1}clearScore(){this.score=0}}!function(e){e.SNAKE_HEAD="snake-head",e.SNAKE_BODY_STR="snake-body-str",e.SNAKE_BODY_CUR="snake-body-cur",e.SNAKE_TAIL="snake-tail",e.UP="up",e.RIGHT="right",e.DOWN="down",e.LEFT="left",e.UP_RIGHT_QUADRANT="up-right-quadrant",e.DOWN_RIGHT_QUADRANT="down-right-quadrant",e.DOWN_LEFT_QUADRANT="down-left-quadrant",e.UP_LEFT_QUADRANT="up-left-quadrant",e.FOOD="food"}(s||(s={}));const a=document.querySelector(".game"),o=document.querySelector(".mask"),r=document.querySelector("#score"),d=document.querySelector("#start");new class{constructor(e,t,s){this.width=e,this.height=t,this.dom=s,this.box={width:0,height:0},this.counting=!1,this.dom=s,this.width=e,this.height=t,this.snakeGame=new h(this.width,this.height),this.init()}init(){this.getBoxSize(this.width,this.height),this.clickGameBtn(),this.changeBtnText("Start");const e=document.createElement("div"),t=document.createElement("div"),s=document.createDocumentFragment();s.append(e,t),this.dom.container.append(s),this.dom.snake=e,this.dom.food=t}clickGameBtn(){this.dom.gameBtn.addEventListener("click",(()=>{this.isCounting()||(!this.isGaming()||this.isPausing()?this.start():this.pause())}))}start(){this.isGaming()||(this.snakeGame.start(),this.clearScore(),this.drawSnake(),this.drawFood()),this.isPausing()&&this.snakeGame.resume(),this.countDown().then((()=>{this.timer=setInterval((()=>{this.move()}),500),document.addEventListener("keydown",this.changeDirection.bind(this)),this.changeBtnText("Pause")}))}countDown(){return new Promise((e=>{this.counting=!0,this.setCounterText("3");let t=3;this.showCounter();const s=setInterval((()=>{t>1?(t--,this.setCounterText(t.toString())):(clearInterval(s),this.counting=!1,this.hideCounter(),e(""))}),1e3)}))}over(){this.showCounter(),this.setCounterText(""),this.snakeGame.over(),clearInterval(this.timer),document.removeEventListener("keydown",this.changeDirection.bind(this)),alert(`You stopped ${this.getScore()} Boliviaball${this.getScore()>1?"s":""}!`),this.changeBtnText("Start")}move(){const e=this.snakeGame.move();this.drawSnake(),"eat"===e?(this.changeScore(),this.drawFood()):e||this.over()}changeDirection(e){switch(e.key){case"ArrowUp":this.snakeGame.changeDirection(t.UP);break;case"ArrowDown":this.snakeGame.changeDirection(t.DOWN);break;case"ArrowLeft":this.snakeGame.changeDirection(t.LEFT);break;case"ArrowRight":this.snakeGame.changeDirection(t.RIGHT)}}changeScore(){this.dom.score.innerText=String(this.getScore())}getBoxSize(e,t){const{width:s,height:i}=this.dom.container.getBoundingClientRect();this.box={width:s/e,height:i/t}}drawSnake(){this.dom.snake.replaceChildren();const e=document.createDocumentFragment();for(let t=0;t<this.snakeGame.getSnakeLength();t++){const s=this.getClasses(this.snakeGame.getSnake()[t-1]||[-1,-1],this.snakeGame.getSnake()[t],this.snakeGame.getSnake()[t+1]||[-1,-1]),[i,n]=this.snakeGame.getSnake()[t],h=this.createBox([i,n],s);e.appendChild(h)}this.dom.snake.appendChild(e)}drawFood(){this.dom.food.replaceChildren();const e=this.createBox(this.snakeGame.getFood(),[s.FOOD]);this.dom.food.appendChild(e)}createBox([e,t],s){const i=document.createElement("div");return i.classList.add("box",...s),i.style.top=t*this.box.height-1+"px",i.style.left=e*this.box.width-1+"px",i}getClasses([e,i],[n,h],[a,o]){const r=[];let d=this.getSnakeBodyDirection([e,i],[n,h]),c=this.getSnakeBodyDirection([n,h],[a,o]);if(0===d)r.push(s.SNAKE_HEAD,s[t[c]]);else if(0===c)r.push(s.SNAKE_TAIL,s[t[d]]);else if(d===c)switch(r.push(s.SNAKE_BODY_STR),d){case t.UP:r.push(s.UP);break;case t.RIGHT:r.push(s.RIGHT);break;case t.DOWN:r.push(s.DOWN);break;case t.LEFT:r.push(s.LEFT)}else r.push(s.SNAKE_BODY_CUR),d===t.LEFT&&c===t.UP||d===t.DOWN&&c===t.RIGHT?r.push(s.UP_RIGHT_QUADRANT):d===t.UP&&c===t.RIGHT||d===t.LEFT&&c===t.DOWN?r.push(s.DOWN_RIGHT_QUADRANT):d===t.UP&&c===t.LEFT||d===t.RIGHT&&c===t.DOWN?r.push(s.DOWN_LEFT_QUADRANT):(d===t.RIGHT&&c===t.UP||d===t.DOWN&&c===t.LEFT)&&r.push(s.UP_LEFT_QUADRANT);return r}getSnakeBodyDirection([e,t],[s,i]){return this.snakeGame.getSnakeBodyDirection([e,t],[s,i])}isGaming(){return this.snakeGame.isGaming()}pause(){this.snakeGame.pause(),clearInterval(this.timer),document.removeEventListener("keydown",this.changeDirection),this.showCounter(),this.setCounterText("Pausing"),this.changeBtnText("Resume")}isPausing(){return this.snakeGame.isPausing()}resume(){this.snakeGame.resume()}clearScore(){this.snakeGame.clearScore(),this.changeScore()}isCounting(){return this.counting}showCounter(){this.dom.counter.classList.remove("hide")}hideCounter(){this.dom.counter.classList.add("hide")}setCounterText(e){this.dom.counter.innerText=e}getScore(){return this.snakeGame.getScore()}changeBtnText(e){this.dom.gameBtn.innerText=e}}(20,20,{container:a,score:r,counter:o,gameBtn:d});
//# sourceMappingURL=index.js.map
